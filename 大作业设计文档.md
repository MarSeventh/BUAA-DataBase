# 智慧医航

##  一、需求分析

### 1功能设计

### 1.1用户相关功能

* 用户注册
* 用户分为两种：社区成员，非社区成员，社区成员输入学工号和密码，非社区成员则是输入用户名和密码。若信息合法，则注册成功，否则报相应的错误（社区成员用户名和学工号相同）
* 用户登录（通过用户名和密码）
* 如果是非社区用户，则需要绑定身份证号
* 删除账号，需要写对用户名，密码，学工号，身份证号等需要写“我确认删除用户”
* 输入自己的症状，获得推荐的挂号指南(通过文心一言api)
* 查询自己的化验结果
* 查询当前挂号是否有号以及排队情况，预测排到的时间
* 查询诊断证明
* 挂号
* 在线缴费

### 1.2医生相关功能

* 通过医生编号和密码进行登录

* 查询自己的排班状态

* 给病人开药

* 给病人设定化验订单

* 给病人下定诊断

### 1.3管理员相关功能

* 通过`admin`用户进行登录

* 查看药品剩余库存
* 添加新的医生账户
* 设定诊室是否可用

### 2.数据流图

### 2.1顶层简略数据流图

![顶层简略数据流图](https://alist.sanyue.site/d/imgbed/%E9%A1%B6%E5%B1%82%E7%AE%80%E7%95%A5%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE.png)

### 2.2零层数据流图

![0层数据流图](https://alist.sanyue.site/d/imgbed/0%E5%B1%82%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE.png)

### 2.3一层数据流图

#### 2.3.1用户系统数据流图

![用户系统数据流图](https://alist.sanyue.site/d/imgbed/%E7%94%A8%E6%88%B7%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE.png)

#### 2.3.2医生系统数据流图

![医生系统数据流图](https://alist.sanyue.site/d/imgbed/%E5%8C%BB%E7%94%9F%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE.png)

#### 2.3.3管理员系统相关功能

![管理员系统数据流图](https://alist.sanyue.site/d/imgbed/%E7%AE%A1%E7%90%86%E5%91%98%E7%B3%BB%E7%BB%9F%E6%95%B0%E6%8D%AE%E6%B5%81%E5%9B%BE.png)

### 3.数据元素表

#### 3.0 User(用户表)

| 属性     | 中文   | 类型        | 备注           |
| -------- | ------ | ----------- | -------------- |
| id       | 编号   | VARCHAR(25) | NOT NULL，主码 |
| username | 用户名 | VarCHAR(25) | NOT NULL       |
| password | 密码   | VarCHAR(25) | NOT NULL       |
| type     | 类型   | VarCHAR(25) | NOT NULL       |

#### 3.1 Patient(病人表)继承User

| 属性     | 中文           | 类型        | 备注           |
| -------- | -------------- | ----------- | -------------- |
| id       | 用户名         | VARCHAR(25) | NOT NULL，外码 |
| isComMem | 是否为社区成员 | BOOLEAN     | NOT NULL       |
| active   | 是否被删除     | BOOLEAN     | NOT NULL       |
| idCard   | 身份证号       | VarCHAR(25) |                |

#### 3.2 Title(科室表)

| 属性 | 中文 | 类型        | 备注          |
| ---- | ---- | ----------- | ------------- |
| id   | 编号 | VARCHAR(25) | NOT NULL,主码 |
| name | 名称 | VARCHAR(25) | NOT NULL      |

#### 3.3 doctor(医生表)

| 属性   | 中文         | 类型        | 备注                   |
| ------ | ------------ | ----------- | ---------------------- |
| id     | 医生编号     | VARCHAR(25) | NOT NULL，外码继承User |
| active | 是否活跃     | BOOLEAN     | NOT NULL               |
| Tid    | 负责科室编号 | VarCHAR(25) | NOT NULL               |

#### 3.4 Drug(药品表)

| 属性        | 中文       | 类型        | 备注           |
| ----------- | ---------- | ----------- | -------------- |
| id          | 药品编号   | VARCHAR(25) | NOT NULL，主码 |
| isBanned    | 是否被禁止 | BOOLEAN     | NOT NULL       |
| price       | 药品价格   | FLOAT       | NOT NULL       |
| Storage     | 存储量     | FLOAT       | NOT NULL       |
| description | 药品描述   | TEXT        | NOT NULL       |

#### 3.5 Counter(订单表)

| 属性   | 中文       | 类型        | 备注                      |
| ------ | ---------- | ----------- | ------------------------- |
| id     | 订单编号   | VARCHAR(25) | NOT NULL, 主码            |
| isPaid | 是否已支付 | BOOLEAN     | NOT NULL                  |
| price  | 价格       | FLOAT       | NOT NULL                  |
| Pid    | 病人编号   | VARCHAR(25) | NOT NULL，外码继承Patient |
| Did    | 医生编号   | VARCHAR(25) | NOT NULL,外码继承DOCTOR   |
| DATE   | 日期       | DATE        | NOT NULL                  |
| type   | 订单种类   | VARCHAR(25) | NOT NULL                  |

#### 3.6 RegistRelation(登记表(挂号)

| 属性       | 中文       | 类型        | 备注                                   |
| ---------- | ---------- | ----------- | -------------------------------------- |
| id         | 订单编号   | VARCHAR(25) | NOT NULL, PRIMARY KEY，外码继承Counter |
| ROOMID     | 诊室编号   | VARCHAR(25) | NOT NULL                               |
| isFinished | 是否被完成 | BOOLEAN     | NOT NULL                               |

#### 3.7 MedicinePurchase

| 属性   | 中文     | 类型        | 备注                   |
| ------ | -------- | ----------- | ---------------------- |
| id     | 订单编号 | VARCHAR(25) | NOT NULL,主码          |
| drugid | 药品编码 | VARCHAR(25) | NOT NULL，外码继承Drug |
| amount | 购买数量 | FLOAT       | NOT NULL               |

#### 3.8 checkItems(检查项目)

| 属性        | 中文         | 类型         | 备注           |
| ----------- | ------------ | ------------ | -------------- |
| id          | 检查项目编号 | VARCHAR(25)  | NOT NULL，主码 |
| price       | 检查项目价格 | FLOAT        | NOT NULL       |
| description | 检擦项目描述 | VARCHAR(255) | NOT NULL       |
| MinResult   | 最小值       | FLOAT        | NOT NULL       |
| MaxResult   | 最大值       | FLOAT        | NOT NULL       |

#### 3.9 LaboratoryShee(化验订单)

| 属性       | 中文         | 类型         | 备注           |
| ---------- | ------------ | ------------ | -------------- |
| id         | 订单编号     | VARCHAR(25)  | NOT NULL, 主码 |
| checkName  | 化验名称     | VARCHAR(25)  | NOT NULL       |
| beginTime  | 检查时间     | DATETIME     | NOT NULL       |
| OutputTime | 结果时间     | DATETIME     | NOT NULL       |
| itemId     | 检查项目编号 | VARCHAR(25)  | NOT NULL,主码  |
| result     | 检查结果     | VARCHAR(255) | NOT NULL       |

#### 3.10 ROOM(诊室表)

| 属性       | 中文       | 类型        | 备注           |
| ---------- | ---------- | ----------- | -------------- |
| id         | 诊室编号   | VARCHAR(25) | NOT NULL，主码 |
| isOccupied | 是否被占用 | BOOLEAN     | NOT NULL       |
| QueueLen   | 排队人数   | int         | NOT NULL       |

#### 3.11 Dispatcher(医生排班调度器)

| 属性       | 中文                     | 类型        | 备注           |
| ---------- | ------------------------ | ----------- | -------------- |
| TimePeriod | 时间段                   | VARCHAR(25) | NOT NULL，主码 |
| ROOMID     | 诊室编号                 | VARCHAR(25) | NOT NULL，主码 |
| doctorId   | 医生编号                 | VARCHAR(25) |                |
| TitleId    | 负责的科室或活动名称编号 | VARCHAR(25) |                |
| DATE       | 日期（星期几）           | VARCHAR(15) | NOT NULL       |

#### 3.12 diagnosis(诊断订单)

| 属性      | 中文     | 类型        | 备注          |
| --------- | -------- | ----------- | ------------- |
| id        | 订单编号 | VARCHAR(25) | NOT NULL,主码 |
| patientId | 病人编号 | VARCHAR(25) | NOT NULL      |
| doctorId  | 医生编号 | VARCHAR(25) | NOT NULL      |
| diagnosis | 诊断说明 | TEXT        | NOT NULL      |
| time      | 诊断时间 | DATETIME    | NOT NULL      |

#### 3.13 CheckCombine(常用检查组合)

| 属性        | 中文       | 属性         | 备注                               |
| ----------- | ---------- | ------------ | ---------------------------------- |
| id          | 编号       | VARCHAR(25)  | NOT NULL,主码                      |
| itemId      | 检查项编号 | VARCHAR(25)  | NOT NULL，主码，外码继承checkItems |
| description | 名称       | VARCHAR(255) | NOT NULL                           |

