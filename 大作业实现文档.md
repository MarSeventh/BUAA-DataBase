# 二、数据库基本表定义

数据库包含7个实体，14张表，使用`sql`语句进行数据库初始化，并将数据库迁移到`django.models`中，每个表对应一个模型类，类中的属性对应对应表中的列。

具体定义以及实现代码见下：

## 用户部分

由于我们的题目中存在多种用户，因此我采用了父类-子类的架构，由`User`表作为父类，`Doctor`和`Patient`作为子类，通过`User.type`进行判断，而管理员表中并无多余信息，因此我并没有针对管理员建表。

表的属性见下。

### 2.0 User(用户表)

| 属性     | 中文   | 类型        | 备注           |
| -------- | ------ | ----------- | -------------- |
| id       | 编号   | VARCHAR(25) | NOT NULL，主码 |
| username | 用户名 | VarCHAR(25) | NOT NULL       |
| password | 密码   | VarCHAR(25) | NOT NULL       |
| type     | 类型   | VarCHAR(25) | NOT NULL       |

```python
class User(models.Model):
    id = models.CharField(primary_key=True, max_length=25)
    username = models.CharField(db_column='USERNAME', max_length=25)  # Field name made lowercase.
    password = models.CharField(max_length=25)
    type = models.CharField(max_length=25)

    class Meta:
        managed = False
        db_table = 'user'
```

### 2.1 Patient(病人表)继承User

| 属性     | 中文           | 类型        | 备注           |
| -------- | -------------- | ----------- | -------------- |
| id       | 用户名         | VARCHAR(25) | NOT NULL，外码 |
| isComMem | 是否为社区成员 | BOOLEAN     | NOT NULL       |
| active   | 是否被删除     | BOOLEAN     | NOT NULL       |
| idCard   | 身份证号       | VarCHAR(25) |                |

```py
class Patient(models.Model):
    id = models.CharField(primary_key=True, max_length=25)
    iscommem = models.IntegerField(db_column='isComMem')  # Field name made lowercase.
    idcard = models.CharField(db_column='idCard', max_length=25, blank=True, null=True)  # Field name made lowercase.
    active = models.IntegerField()

    class Meta:
        managed = False
        db_table = 'patient'
```



### 2.2 Doctor(医生表)继承User

| 属性   | 中文         | 类型        | 备注                   |
| ------ | ------------ | ----------- | ---------------------- |
| id     | 医生编号     | VARCHAR(25) | NOT NULL，外码继承User |
| active | 是否活跃     | BOOLEAN     | NOT NULL               |
| Tid    | 负责科室编号 | VarCHAR(25) | NOT NULL               |

```py
class Doctor(models.Model):
    id = models.CharField(primary_key=True, max_length=25)
    tid = models.ForeignKey('Titles', models.DO_NOTHING, db_column='Tid')  # Field name made lowercase.
    active = models.IntegerField()

    class Meta:
        managed = False
        db_table = 'doctor'
```



### 2.3 Title(科室表)

| 属性 | 中文 | 类型        | 备注          |
| ---- | ---- | ----------- | ------------- |
| id   | 编号 | VARCHAR(25) | NOT NULL,主码 |
| name | 名称 | VARCHAR(25) | NOT NULL      |

### 2.4 Drug(药品表)

| 属性        | 中文       | 类型        | 备注           |
| ----------- | ---------- | ----------- | -------------- |
| id          | 药品编号   | VARCHAR(25) | NOT NULL，主码 |
| isBanned    | 是否被禁止 | BOOLEAN     | NOT NULL       |
| price       | 药品价格   | FLOAT       | NOT NULL       |
| Storage     | 存储量     | FLOAT       | NOT NULL       |
| description | 药品描述   | TEXT        | NOT NULL       |

### 2.5 Counter(订单表)

| 属性   | 中文       | 类型        | 备注                      |
| ------ | ---------- | ----------- | ------------------------- |
| id     | 订单编号   | VARCHAR(25) | NOT NULL, 主码            |
| isPaid | 是否已支付 | BOOLEAN     | NOT NULL                  |
| price  | 价格       | FLOAT       | NOT NULL                  |
| Pid    | 病人编号   | VARCHAR(25) | NOT NULL，外码继承Patient |
| Did    | 医生编号   | VARCHAR(25) | NOT NULL,外码继承DOCTOR   |
| DATE   | 日期       | DATE        | NOT NULL                  |
| type   | 订单种类   | VARCHAR(25) | NOT NULL                  |

### 2.6 RegistRelation(登记表(挂号)

| 属性       | 中文       | 类型        | 备注                                   |
| ---------- | ---------- | ----------- | -------------------------------------- |
| id         | 订单编号   | VARCHAR(25) | NOT NULL, PRIMARY KEY，外码继承Counter |
| ROOMID     | 诊室编号   | VARCHAR(25) | NOT NULL                               |
| isFinished | 是否被完成 | BOOLEAN     | NOT NULL                               |

### 2.7 MedicinePurchase

| 属性   | 中文     | 类型        | 备注                   |
| ------ | -------- | ----------- | ---------------------- |
| id     | 订单编号 | VARCHAR(25) | NOT NULL,主码          |
| drugid | 药品编码 | VARCHAR(25) | NOT NULL，外码继承Drug |
| amount | 购买数量 | FLOAT       | NOT NULL               |

### 2.8 checkItems(检查项目)

| 属性        | 中文         | 类型         | 备注           |
| ----------- | ------------ | ------------ | -------------- |
| id          | 检查项目编号 | VARCHAR(25)  | NOT NULL，主码 |
| price       | 检查项目价格 | FLOAT        | NOT NULL       |
| description | 检擦项目描述 | VARCHAR(255) | NOT NULL       |
| MinResult   | 最小值       | FLOAT        | NOT NULL       |
| MaxResult   | 最大值       | FLOAT        | NOT NULL       |

### 2.9 LaboratoryShee(化验订单)

| 属性       | 中文         | 类型         | 备注           |
| ---------- | ------------ | ------------ | -------------- |
| id         | 订单编号     | VARCHAR(25)  | NOT NULL, 主码 |
| checkName  | 化验名称     | VARCHAR(25)  | NOT NULL       |
| beginTime  | 检查时间     | DATETIME     | NOT NULL       |
| OutputTime | 结果时间     | DATETIME     | NOT NULL       |
| itemId     | 检查项目编号 | VARCHAR(25)  | NOT NULL,主码  |
| result     | 检查结果     | VARCHAR(255) | NOT NULL       |

### 2.10 ROOM(诊室表)

| 属性       | 中文       | 类型        | 备注           |
| ---------- | ---------- | ----------- | -------------- |
| id         | 诊室编号   | VARCHAR(25) | NOT NULL，主码 |
| isOccupied | 是否被占用 | BOOLEAN     | NOT NULL       |
| QueueLen   | 排队人数   | int         | NOT NULL       |

### 2.11 Dispatcher(医生排班调度器)

| 属性       | 中文                     | 类型        | 备注           |
| ---------- | ------------------------ | ----------- | -------------- |
| TimePeriod | 时间段                   | VARCHAR(25) | NOT NULL，主码 |
| ROOMID     | 诊室编号                 | VARCHAR(25) | NOT NULL，主码 |
| doctorId   | 医生编号                 | VARCHAR(25) |                |
| TitleId    | 负责的科室或活动名称编号 | VARCHAR(25) |                |
| DATE       | 日期（星期几）           | VARCHAR(15) | NOT NULL       |

### 2.12 diagnosis(诊断订单)

| 属性      | 中文     | 类型        | 备注          |
| --------- | -------- | ----------- | ------------- |
| id        | 订单编号 | VARCHAR(25) | NOT NULL,主码 |
| patientId | 病人编号 | VARCHAR(25) | NOT NULL      |
| doctorId  | 医生编号 | VARCHAR(25) | NOT NULL      |
| diagnosis | 诊断说明 | TEXT        | NOT NULL      |
| time      | 诊断时间 | DATETIME    | NOT NULL      |

### 2.13 CheckCombine(常用检查组合)

| 属性        | 中文       | 属性         | 备注                               |
| ----------- | ---------- | ------------ | ---------------------------------- |
| id          | 编号       | VARCHAR(25)  | NOT NULL,主码                      |
| itemId      | 检查项编号 | VARCHAR(25)  | NOT NULL，主码，外码继承checkItems |
| description | 名称       | VARCHAR(255) | NOT NULL                           |

